<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf8">
		<style>
			* {
				margin: 0;
				padding: 0;
				box-sizing: border-box;
			}

			svg {
				border: 1px solid #ddd;
				overflow: visible;
				background-color: #eee;
			}

			#wrapper {
				width: 1000px;
				margin: 0 auto;
			}

			#wrapper section {
				width: 1000px;
				margin: 20px 0;
				padding: 19px;
				border: solid 1px #ddd;
				background-color: #f8f8f8;
			}

			#wrapper h1 {
				margin-bottom: 20px;
			}

			#wrapper article {
				width: 100%;
				overflow: hidden;
			}

			#wrapper figure {
				width: 500px;
				height: 500px;
				float: left;
			}
		</style>
		<link rel="stylesheet" href="../plugins/draw/svg_geometry_plugin_draw.css">
	</head>
	<body>
		<div id="wrapper">
			<section>
				<h1>[Face Detection] Wise FaceDetection ROI</h1>
				<article>
					<figure>
						<svg 
							width="960" 
							height="500" 
							id="wfd_roi"
							xmlns="http://www.w3.org/2000/svg" 
							xmlns:xlink="http://www.w3.org/1999/xlink">
						</svg> 
					</figure>
				</article>
			</section>
			<section>
				<h1>[MD, IVA] ROI v2</h1>
				<article>
					<figure>
						<svg 
							width="960" 
							height="500" 
							id="roi"
							xmlns="http://www.w3.org/2000/svg" 
							xmlns:xlink="http://www.w3.org/1999/xlink">
						</svg> 
					</figure>
				</article>
			</section>
			<section>
				<h1>[IVA] Virtual Line</h1>
				<article>
					<figure>
						<svg 
							width="960" 
							height="500" 
							id="virtual_line"
							xmlns="http://www.w3.org/2000/svg" 
							xmlns:xlink="http://www.w3.org/1999/xlink">
						</svg> 
					</figure>
				</article>
			</section>
			<section>
				<h1>[IVA] Common Calibration</h1>
				<article>
					<figure>
						<svg 
							width="960" 
							height="500" 
							id="common_calibration"
							xmlns="http://www.w3.org/2000/svg" 
							xmlns:xlink="http://www.w3.org/1999/xlink">
						</svg> 
					</figure>
				</article>
			</section>
		</div>
		<script src="../modules/svg_geometry_product.js"></script>
		<script src="../modules/svg_geometry.js"></script>

		<script src="../plugins/draw/arrow-image-helper.js"></script>
		<script src="../plugins/draw/circle-helper.js"></script>
    	<script src="../plugins/draw/geometry-manager.js"></script>
		<script src="../plugins/draw/group-helper.js"></script>
		<script src="../plugins/draw/icon-helper.js"></script>
		<script src="../plugins/draw/line-helper.js"></script>
		<script src="../plugins/draw/polygon-helper.js"></script>
		<script src="../plugins/draw/text-helper.js"></script>
		<script src="../plugins/draw/wise-facedetection-helper.js"></script>
		<script src="../plugins/draw/svg_geometry_plugin_draw.js"></script>

		<script src="../plugins/customeditor/state.js"></script>
		<script src="../plugins/customeditor/fixed_ratio_state.js"></script>
		<script src="../plugins/customeditor/line_state.js"></script>
		<script src="../plugins/customeditor/ractangle_state.js"></script>
		<script src="../plugins/customeditor/svg_geometry_plugin_customeditor.js"></script>

		<script src="../plugins/svg_geometry_plugin_customeditor_v2.js"></script>

		<script>
			var colorFactory = {
				red: "#CE534D",
				blue: "#3184F9",
				includeArea: {
					fill: '#ff6633',
					line: '#ff6633',
					point: '#ff6633'
				},
				excludeArea: {
					fill: '#000000',
					line: '#ffffff',
					point: '#999999'
				}
			};
			function getROIOptions(){
				return {
					fillColor: colorFactory.includeArea.fill,
					lineColor: colorFactory.includeArea.line,
					pointColor: colorFactory.includeArea.point,
	                lineStrokeWidth: 4,
	                circleRadius: 5,
	                useEvent: true,
	                useCursor: true,
	                minPoint: 4,
	                maxPoint: 8,
	                fill: true,
	                fillOpacity: "0.2"
	            };
			}

			function getLineOptions(){
				return {
					fillColor: colorFactory.includeArea.fill,
					lineColor: colorFactory.includeArea.line,
					pointColor: colorFactory.includeArea.point,
	                lineStrokeWidth: 4,
	                circleRadius: 6,
	                useEvent: true,
	                useCursor: true,
	                minPoint: 2,
	                maxPoint: 8,
	                arrow: {
	                    mode: 'R',
	                    min: 'L',
	                    max: 'LR',
	                    text: true
	                }
	            };
			}

			window.onload = function(){
				//[Face Detection] Wise FaceDetection ROI
				var wiseFDROI = document.getElementById('wfd_roi');
				var wiseFDROIEditor = new SVGGeometry(wiseFDROI);
				var wiseFDOptions = getROIOptions();
				wiseFDOptions.points = [
					[0, 0],
					[0, 480],
					[854, 480],
					[854, 0]
				];
				wiseFDOptions.ratio = [1.77, 1];
				wiseFDOptions.fixedRatio = true;
				wiseFDOptions.wiseFaceDetection = {
                    strokeWidth: 2,
                    strokeColor: colorFactory.includeArea.line,
                    fillOpacity: 0,
                    heightRatio: 4 //Wise Face Detection에 표현되는 원의 반지름 %
                };
				wiseFDROIEditor.draw(wiseFDOptions);

				//[MD, IVA] ROI
				var roi = document.getElementById('roi');
				var roiEditor = new SVGGeometry(roi);
				var roiOptions = getROIOptions();
				var roiObj = [];
				var selectROIObj = function(obj){
					for(var i = 0, ii = roiObj.length; i < ii; i++){
						roiObj[i].normal();
					}

					obj.active();
				};
				var defaultROIPoints = [
					[
						[686, 319],
						[455, 333],
						[465, 467],
						[694, 459]
					],
					[
						[294, 46],
						[135, 55],
						[150, 216],
						[367, 194]
					]
				];
				roiOptions.event = {
					start: function(){

					},
					end: function(obj){
						roiObj.push(obj);
						selectROIObj(obj);
					},
					mouseup: function(){
						var self = this;
						//포인트가 추가된뒤에 active 효과를 적용
						setTimeout(function(){
							selectROIObj(self);
						});
					}
				};

				roiEditor.customEditorV2(roiOptions);
				for(var i = 0, ii = defaultROIPoints.length; i < ii; i++){
					roiOptions.points = defaultROIPoints[i];
					roiOptions.fillColor = i === 0 ? colorFactory.includeArea.fill : colorFactory.excludeArea.fill;
					roiOptions.pointColor = i === 0 ? colorFactory.includeArea.point : colorFactory.excludeArea.point;
					roiOptions.lineColor = i === 0 ? colorFactory.includeArea.line : colorFactory.excludeArea.line;
					roiObj.push(roiEditor.draw(roiOptions));
				}
				selectROIObj(roiObj[0]);

				//[IVA] Virtual Line
				var virtualLine = document.getElementById('virtual_line');
				var virtualLineEditor = new SVGGeometry(virtualLine);
				var virtualLineOptions = getLineOptions();
				virtualLineOptions.fillColor = colorFactory.blue;
				virtualLineOptions.lineColor = colorFactory.blue;
				virtualLineOptions.pointColor = colorFactory.blue;
				var virtualLineObj = [];
				var defaultVirtualLinePoints = [
					[
						[736, 146],
						[455, 333]
					],
					[
						[651, 332],
						[295, 152]
					]
				];
				var selectLineObj = function(obj){
					for(var i = 0, ii = virtualLineObj.length; i < ii; i++){
						virtualLineObj[i].normal();
					}

					obj.active();
				};
				virtualLineOptions.event = {
					start: function(){},
					end: function(obj){
						virtualLineObj.push(obj);
						selectLineObj(obj);
					},
					mouseup: function(){
						var self = this;
						setTimeout(function(){
							selectLineObj(self);
						});
					}
				};
				virtualLineEditor.customEditor(virtualLineOptions);
				for(var i = 0, ii = defaultVirtualLinePoints.length; i < ii; i++){
					virtualLineOptions.points = defaultVirtualLinePoints[i];
					virtualLineObj.push(virtualLineEditor.draw(virtualLineOptions));
				}
				selectLineObj(virtualLineObj[0]);

				//[IVA] Common Calibration
				var commonCalibration = document.getElementById('common_calibration');
				var commonCalibrationEditor = new SVGGeometry(commonCalibration);
				var commonCalibrationOptions = getROIOptions();
				commonCalibrationOptions.initCenter = true;
				commonCalibrationOptions.notUseMoveTopLayer = true;
				commonCalibrationOptions.useOnlyRectangle = true;
				commonCalibrationOptions.minSize = {
					width: 100,
					height: 100,
				};
				commonCalibrationOptions.maxSize = {
					width: 854,
					height: 480,
				};
				commonCalibrationOptions.points = [
					[0, 0],
					[0, 480],
					[854, 480],
					[854, 0]
				];
				commonCalibrationOptions.fillColor = colorFactory.red;
				commonCalibrationOptions.lineColor = colorFactory.red;
				commonCalibrationOptions.pointColor = colorFactory.red;
				commonCalibrationEditor.draw(commonCalibrationOptions);
				commonCalibrationOptions.points = [
					[0, 0],
					[0, 100],
					[100, 100],
					[100, 0]
				];
				commonCalibrationOptions.fillColor = colorFactory.blue;
				commonCalibrationOptions.lineColor = colorFactory.blue;
				commonCalibrationOptions.pointColor = colorFactory.blue;
				commonCalibrationEditor.draw(commonCalibrationOptions);
			};
		</script>
	</body>
</html>